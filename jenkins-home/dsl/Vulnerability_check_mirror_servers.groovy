execStored = 20
name = "Vulnerability_check_mirror_servers"
script = readFileFromWorkspace('../../' + name +'.script')

job(name) {

  description('Vulnerability check at mirror servers.')

  logRotator(-1,execStored,-1,-1)

  authorization {
    permission('hudson.model.Item.Read', 'authenticated')
    permission('hudson.model.Item.Build', 'palg')
    permission('hudson.model.Item.Cancel', 'palg')
    permission('hudson.model.Item.Read', 'palg')
    permission('hudson.model.Item.Workspace', 'palg')
    permission('hudson.model.Item.Configure', 'palg')
  }

  wrappers {
    timestamps()
    colorizeOutput()
    credentialsBinding {
      usernamePassword('SECRET_USER', 'SECRET_PASS', 'm2m_dsn_user')
    }
  }

  steps {
    shell(script)
  }

  publishers {
    extendedEmail {
      recipientList('eloy.monterodelrio@telefonica.com,brian.romero@ust-global.com,pablo.lopezgarcia@telefonica.com')
      attachmentPatterns("mirrorServers/*")	
      triggers {
        success {
          subject("Vulnerabilities found at mirror servers.")
          content('${BUILD_LOG, maxLines=9999, escapeHtml=false}')
          sendTo {
            recipientList()
          }
        }
        failure {
          subject(name)
          content('${BUILD_LOG, maxLines=9999, escapeHtml=false}')
          sendTo {
            recipientList()
          }
        }

      }
    }
  }
}
